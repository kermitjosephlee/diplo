// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id            Int         @id @default(autoincrement())
  uuid          String      @unique
  name          String
  userName      String      @unique
  email         String      @unique
  password      String
  chatServiceId Int
  chatService   ChatService @relation(fields: [chatServiceId], references: [id])
  startDate     DateTime    @default(now())
  endDate       DateTime?
  isActive      Boolean     @default(true)
  player        Player[]
}

model Game {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique
  name      String
  startDate DateTime  @default(now())
  endDate   DateTime?
  gameLog   String[]
  mapId     Int       @unique
  map       Map[]
  player    Player[]
  turn      Turn[]
}

model Country {
  id           Int                 @id @default(autoincrement())
  name         CountryName
  abbreviation CountryAbbreviation
  adjective    CountryAdjective
  locationId   Int?
  location     Location?           @relation(fields: [locationId], references: [id])
}

model Player {
  id        Int     @id @default(autoincrement())
  userId    Int
  user      User    @relation(fields: [userId], references: [id])
  countryId Int
  gameId    Int
  game      Game    @relation(fields: [gameId], references: [id])
  isActive  Boolean @default(false)
  isWinner  Boolean @default(false)
  orders    Order[]
}

// turn has many orders
model Turn {
  id          Int       @id @default(autoincrement())
  createdAt   DateTime  @default(now())
  finalizedAt DateTime
  game        Game?     @relation(fields: [gameId], references: [id])
  gameId      Int?
  order       Order[]
  year        Int
  phase       PhaseEnum
  mapId       Int
  map         Map       @relation(fields: [mapId], references: [id])
}

model Order {
  id               Int        @id @default(autoincrement())
  createdAt        DateTime   @default(now())
  updatedAt        DateTime[]
  orders           String
  player           Player?    @relation(fields: [playerId], references: [id])
  playerId         Int?
  turnId           Int
  turn             Turn       @relation(fields: [turnId], references: [id])
  originId         Int
  destinationId    Int
  unitType         Unit
  coast            Coast?
  actionType       ActionType @default(HOLD)
  supportingUnitId Int?
}

model Location {
  id                         Int                  @id @default(autoincrement())
  name                       String
  shortName                  LocationAbbreviation
  isMaritime                 Boolean
  isTerrestrial              Boolean
  isLandLocked               Boolean
  isSupplyCenter             Boolean
  occupyingNationsId         Int
  occupyingNations           Country[]
  initialNation              CountryName?
  coasts                     Coast[]
  borderingLocations         Location[]           @relation("borderingLocations")
  borderingLocationsRelation Location[]           @relation("borderingLocations")
}

model Map {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  gameId    Int
  game      Game     @relation(fields: [gameId], references: [id])
  ordersId  Int      @unique
  svg       String
  turn      Turn[]
}

model ChatService {
  id                    Int      @id @default(autoincrement())
  serviceProvider       String
  serviceProviderUserId String
  userId                Int      @unique
  user                  User[]
  createdAt             DateTime @default(now())
}

enum CountryAbbreviation {
  AUS
  ENG
  FRA
  GER
  ITA
  RUS
  TUR
}

enum CountryName {
  Austria
  England
  France
  Germany
  Italy
  Russia
  Turkey
}

enum CountryAdjective {
  Austrian
  English
  French
  Germany
  Italian
  Russian
  Turkish
}

enum Coast {
  NORTH
  SOUTH
  EAST
}

enum LocationType {
  Maritime
  Terrestrial
}

enum LocationAbbreviation {
  ADR
  AEG
  ALB
  ANK
  APU
  ARM
  BAL
  BAR
  BEL
  BER
  BLA
  BOH
  BOT
  BRE
  BUD
  BUL
  BUR
  CLY
  CON
  DEN
  EAS
  EDI
  ENG
  FIN
  GAL
  GAS
  GRE
  HEL
  HOL
  ION
  IRI
  KIE
  LON
  LVN
  LVP
  LYO
  MAO
  MAR
  MOS
  MUN
  NAF
  NAO
  NAP
  NTH
  NWG
  NWY
  PAR
  PIC
  PIE
  POR
  PRU
  ROM
  RUH
  RUM
  SEV
  SIL
  SKA
  SMY
  SPA
  STP
  SWE
  SYR
  TRI
  TUN
  TUS
  TYR
  TYS
  VEN
  VIE
  WAL
  WAR
  WES
  YOR
}

enum Unit {
  ARMY
  NAVY
}

enum ActionType {
  CONVOY
  HOLD
  MOVE
  SUPPORT
}

enum PhaseEnum {
  BUILD
  MOVEMENT
  RETREAT
}

enum SeasonEnum {
  FALL
  SPRING
  SUMMER
  WINTER
}
